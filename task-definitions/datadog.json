[
  {
    "name": "datadog-agent",
    "image": "datadog/agent:7",
    "essential": true,
    "cpu": ${datadog_container_cpu},
    "memory": ${datadog_container_memory},
    "portMappings": [
      {
        "hostPort": 8125,
        "protocol": "udp",
        "containerPort": 8125
      },
      {
        "hostPort": 8126,
        "protocol": "tcp",
        "containerPort": 8126
      }
    ],
    "secrets": [
        {
          "name": "DD_API_KEY",
          "valueFrom": "${dd_api_key_parameter_arn}"
        }
    ],
    "environment": [
      {
        "name": "DD_LOGS_ENABLED",
        "value": "true"
      },
      {
        "name": "DD_SITE",
        "value": "datadoghq.eu"
      },
      {
        "name": "DD_DOGSTATSD_NON_LOCAL_TRAFFIC",
        "value": "true"
      },
      {
        "name": "DD_DOGSTATSD_PORT",
        "value": "8125"
      },
      {
        "name": "DD_DOGSTATSD_DISABLE",
        "value": "false"
      },
      {
        "name": "DD_DOGSTATSD_METRICS_STATS_ENABLE",
        "value": "false"
      },
      {
        "name": "DD_DOGSTATSD_MAPPER_PROFILES",
		"value": "${dd_dogstatsd_mapper_profiles}"
      }
    ],
    "mountPoints": [
        {
          "containerPath": "/var/run/docker.sock",
          "sourceVolume": "docker_sock",
          "readOnly": true
        },
        {
          "containerPath": "/host/sys/fs/cgroup",
          "sourceVolume": "cgroup",
          "readOnly": true
        },
        {
          "containerPath": "/host/proc",
          "sourceVolume": "proc",
          "readOnly": true
        }
    ],
    "dockerLabels": {
      "com.datadoghq.ad.instances": "[{\"url\": \"${webserver_url}\"}]",
      "com.datadoghq.ad.check_names": "[\"airflow\"]",
      "com.datadoghq.ad.init_configs": "[{}]"
    }
  }
]
